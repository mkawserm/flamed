syntax = "proto3";
package pb;

//option go_package = "pkg/pb";

message FlameEntry {
  bytes namespace = 1;
  bytes key = 2;
  bytes value = 3;
}

message FlameAction {
  enum FlameActionType {
    CREATE = 0;
    UPDATE = 1;
    APPEND = 2;
    DELETE = 3;
  }

  FlameActionType flameActionType = 1;
  FlameEntry flameEntry = 2;
}

message FlameBatchAction {
  repeated FlameAction flameActionList = 1;
}

message FlameBatchRead {
  repeated FlameEntry flameEntryList = 1;
}

message FlameSnapshotEntry {
  bytes uid = 1;
  bytes data = 2;
}

message FlameSnapshot {
  uint32 version = 1;
  uint64 length = 2;
  repeated FlameSnapshotEntry flameSnapshotEntryList = 3;
}

message FlameIndexField {
  enum IndexFieldType {
    TEXT = 0;
    NUMERIC = 1;
    BOOLEAN = 2;
    GEO_POINT = 3;
    DATE_TIME = 4;
  }

  IndexFieldType indexFieldType = 1;

  string name = 2;
  string analyzer = 3;
  bool enabled = 4;
  bool index = 5;
  bool store = 6;
  bool includeTermVectors = 7;
  bool includeInAll = 8;
  bool docValues = 9;
}

message FlameIndexMeta {
  enum DocumentType {
    NONE = 0;
    JSON = 1;
    CUSTOM = 2;
  }

  bytes namespace = 1;
  uint32 version = 2;
  uint64 createdAt = 3;
  uint64 updatedAt = 4;
  bool indexEnabled = 5;
  DocumentType documentType = 6;
  repeated FlameIndexField flameIndexFieldList = 7;
}

message FlameUser {
  enum FlameUserType {
    SUPER_USER = 0;
    NORMAL_USER = 1;
  }

  FlameUserType flameUserType = 1;

  string username = 2;
  string password = 3;
  uint64 createdAt = 4;
  uint64 updatedAt = 5;
  bytes userData = 6;
}

message FlameAccessControl {
  string username = 1;
  bytes namespace = 2;
  bytes permission = 3; /* First 1 byte is considered as permission.
                            Counted right to left bit
                            Permission format:
                              first byte read,
                              second byte write,
                              third byte update,
                              fourth byte delete
                        */
  uint64 createdAt = 4;
  uint64 updatedAt = 5;
}

message FlameProposal {
  enum FlameProposalType {
    BATCH_ACTION = 0; /* FlameBatchAction */

    ADD_INDEX_META = 1; /* FlameIndexMeta */
    UPDATE_INDEX_META = 2; /* FlameIndexMeta */
    DELETE_INDEX_META = 3; /* FlameIndexMeta */

    ADD_USER = 4; /* FlameUser */
    UPDATE_USER = 5; /* FlameUser */
    DELETE_USER = 6; /* FlameUser */

    ADD_ACCESS_CONTROL = 7; /* FlameAccessControl */
    UPDATE_ACCESS_CONTROL = 8; /* FlameAccessControl */
    DELETE_ACCESS_CONTROL = 9; /* FlameAccessControl */
  }

  FlameProposalType flameProposalType = 1;
  bytes flameProposalData = 2;
}